// !!!
// WARNING: do not directly import this file, instead import the 
//          version in your theme's directory, 
//          for example alta/widgets/_oj.common.formlayout.scss
// !!!

$includeFormLayoutClasses:    $includeAllClasses !default;

// todo: move to utility file?
@mixin oj-form-responsive($selectorPrefix)
{

  // nowrap label support
  .oj-form > .oj-row > .oj-col:nth-child(odd) > .#{$selectorPrefix}-label-nowrap,
  .#{$selectorPrefix}-labels-nowrap > .oj-row > .oj-col:nth-child(odd) > .oj-label {
    white-space: nowrap;
  }


  // inline label suport
  .oj-form > .oj-row > .oj-col:nth-child(odd) > .#{$selectorPrefix}-label-inline,
  .#{$selectorPrefix}-labels-inline > .oj-row > .oj-col:nth-child(odd) > .oj-label {
    // we're using width of 100% and so on for the case where 
    // the label-nowrap classes are used.
    // See the form layout demo titled "label wrapping" 
    // before checking the values in here
    width: 100%;
    box-sizing: border-box;
    overflow: hidden;
    text-overflow: ellipsis;
    @include oj-bidi-property(
         $property: 'text-align', 
         $startOrEnd: end);
  }



  // when labels are inline we don't float.
  // but if we don't float, the label's height collapses
  // (e.g., the help def's bottom border doesn't show up)
  // without display: inline-block 
  .#{$selectorPrefix}-label-inline .oj-label-required-icon,
  .#{$selectorPrefix}-labels-inline > .oj-row > .oj-col:nth-child(odd) .oj-label-required-icon,
  .#{$selectorPrefix}-label-inline .oj-label-help-icon,
  .#{$selectorPrefix}-labels-inline > .oj-row > .oj-col:nth-child(odd) .oj-label-help-icon,
  .#{$selectorPrefix}-label-inline.oj-label,
  .#{$selectorPrefix}-labels-inline > .oj-row > .oj-col:nth-child(odd) label {
     float:none; 
     display: inline-block;
     // when we don't float, then the order of the dom is the order of what
     // you see, so we want spacing after the icons, not before.
     @include oj-ltr {
       margin-left: 0;
       margin-right: 6px;
     }
     @include oj-rtl(){
       margin-right: 0;
       margin-left: 6px;
     }
  }


  .#{$selectorPrefix}-label-inline.oj-label,
  .#{$selectorPrefix}-labels-inline > .oj-row > .oj-col > .oj-label {
    display: inline-block;
    vertical-align: top;
    margin-top: $formControlLabelInlineMarginTop;
    // box sizing required for firefox or the 
    // gutter padding  doesn't work
    @include oj-box-sizing-property(border-box);

    @include oj-ltr {
      padding-right: $formControlLabelInlineGutter; 
    }

    @include oj-rtl(){
      padding-left: $formControlLabelInlineGutter;
    }
  }


  // by default inline labels are designed to line up with 
  // the text in an input, but a special label class "oj-label-inline-top is needed
  // when the label should be top aligned, like on radio/checkbox set group labels
  .#{$selectorPrefix}-label-inline.oj-label-inline-top,
  .#{$selectorPrefix}-labels-inline > .oj-row > .oj-col > .oj-label-inline-top
  {
    margin-top: 0;
  }

  
  // This is for cases where there are label modifiers (required, etc), in which case
  // the properties below need to be inherited by oj-label-group
  // otherwise the ellipsis doesn't show when the label-nowrap classes are used.
  // See the form layout demo titled "label wrapping" 
  // before checking the values in here
  .oj-form > .oj-row > .oj-col:nth-child(odd) > .#{$selectorPrefix}-label-inline .oj-label-group,
  .#{$selectorPrefix}-labels-inline > .oj-row > .oj-col:nth-child(odd) > .oj-label .oj-label-group{
    width: inherit;
    overflow: inherit;
    text-overflow: inherit;
  }

}

@if $includeFormLayoutClasses != false {
  @include exports("common.formlayout") {

    // headers inside a form layout have different margins than regular headers
    .oj-form > hr,
    .oj-form > h1,
    .oj-form > h2,
    .oj-form > h3,
    .oj-form > h4 {
      // margins will collapse with margin in the row above it, but you still need to 
      // subtract the form control margin 
      margin: (15px - $wrappableMarginBottom) 0 15px 0;
    }




    //
    // Stacked (non-responsive) form layout
    //

    .oj-form > .oj-form-control {
      margin-bottom: $formLayoutMarginBottom;
    }

    // in some cases form controls are grouped togeether with the 
    // oj-form-control-group class, in that case you need
    // to subtract wrappableMarginBottom
    .oj-form > .oj-form-control-group {
      margin-bottom: ($formLayoutMarginBottom - $wrappableMarginBottom);
    }





    // 
    // Responsive form layout
    //

    .oj-form > .oj-row > .oj-col {
      // remove all grid padding, padding will come from the label when appropriate
      padding: 0;
    }

    // Originally the margin was on .oj-form .oj-row. However there was a problem. 
    // In the "across" form layout there's 4 grid cells in a row. 
    // On large screens these 4 cells are all on one line. 
    // But on medium screens the first 2 cells stay on the 
    // first line and the second 2 cells wrap to a new line 
    // to create a second "row". However there's no actual row 
    // class in this case, so the margins need to be on the field columns.
    //
    // The :last-child is to handle cases where there is a colspan
    // across all the cells.
    //
    // See the form layout demo titled "inline responsive across" 
    // before checking in any changes to where the margin is placed.
    .oj-form > .oj-row > .oj-col:nth-child(even),
    .oj-form > .oj-row > .oj-col:last-child {
      margin: 0 0 ($formLayoutMarginBottom - $wrappableMarginBottom) 0;
    }
      

    @if $responsiveQuerySmallUp {
      @media #{$responsiveQuerySmallUp} 
      {
        @include oj-form-responsive("oj-sm");
      }
    }

    @if $responsiveQueryMediumUp {
      @media #{$responsiveQueryMediumUp} 
      {
        @include oj-form-responsive("oj-md");
      }
    }

    @if $responsiveQueryLargeUp {
      @media #{$responsiveQueryLargeUp} 
      {
        @include oj-form-responsive("oj-lg");
      }
    }

    @if $responsiveQueryXlargeUp {
      @media #{$responsiveQueryXlargeUp} 
      {
        @include oj-form-responsive("oj-xl");
      }
    }
  }
}