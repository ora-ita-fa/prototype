define(["ojs/ojcore","jquery","ojs/ojcomponentcore"],function(b,e){(function(){b.ta("oj.ojMenu",e.oj.baseComponent,{version:"1.0.0",defaultElement:"\x3cul\x3e",delay:300,role:"menu",widgetEventPrefix:"oj",mn:"ojMenuClickAwayHandler",options:{menuPosition:{my:"left top",at:"left bottom"},menuSelector:"ul",submenuPosition:{my:"left top",at:"right top"},beforeShow:null,blur:null,focus:null,select:null},_create:function(){this.Ol=this.element;this.mu=!1;this.element.uniqueId().addClass("oj-menu oj-component").toggleClass("oj-menu-icons",
!!this.element.find(".oj-component-icon").length).attr({role:this.role,tabIndex:"0"});this._on(!0,{"mousedown .oj-menu-item":function(a){this.options.disabled&&a.preventDefault()},click:function(a){this.options.disabled&&a.preventDefault()},keydown:function(a){this.options.disabled&&a.keyCode===e.ui.keyCode.ESCAPE&&this.bb&&this.zr(a)}});this.options.disabled&&this.element.addClass("oj-disabled").attr("aria-disabled","true");this._on({"mousedown .oj-menu-item \x3e a":function(a){a.preventDefault()},
"click .oj-disabled \x3e a":function(a){a.preventDefault()},click:function(){this.mu=!1},"click .oj-menu-item:has(a)":function(a){var b=e(a.target).closest(".oj-menu-item");!this.mu&&b.not(".oj-disabled").length&&(this.mu=!0,this.aa&&this.aa.closest(b).length&&this.aa.get(0)!=b.get(0)||(b.has(".oj-menu").length?this.expand(a):(this.select(a),this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.aa&&1===this.aa.parents(".oj-menu").length&&clearTimeout(this.ef)))))},"mouseenter .oj-menu-item":function(a){var b=
e(a.currentTarget);b.siblings().children(".oj-active").removeClass("oj-active");this.focus(a,b)},mouseleave:this.collapseAll,"mouseleave .oj-menu":this.collapseAll,focus:function(a,b){var f=this.aa||this.element.children(".oj-menu-item").eq(0);b||this.focus(a,f)},keydown:this.bi,keyup:function(a){if(a.keyCode==e.ui.keyCode.ENTER||a.keyCode==e.ui.keyCode.SPACE)this.wn=!1}});this.kb();this.yM();this._super()},yM:function(){var b=this.document.data(this.mn);b||(b=function(b){if("focus"===b.type||"mousedown"===
b.type||93==b.which||121==b.which&&b.shiftKey||93==b.keyCode){var d=a.slice(0,a.length);e.each(d,function(a,d){e(b.target).closest(d.element).length||"keydown"!==b.type&&("mousedown"!==b.type||3!==b.which)&&e(b.target).closest(d.bb).length||(d.collapseAll(b),d.bb&&d.vn(b))})}},this.document.data(this.mn,b),this.document[0].addEventListener("keydown",b,!0),this.document[0].addEventListener("mousedown",b,!0),this.document[0].addEventListener("focus",b,!0))},VN:function(){var a=this.document.data(this.mn);
a&&1===e(":oj-menu").length&&(this.document[0].removeEventListener("keydown",a,!0),this.document[0].removeEventListener("mousedown",a,!0),this.document[0].removeEventListener("focus",a,!0),this.document.removeData(this.mn))},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".oj-menu").addBack().removeClass("oj-menu oj-component oj-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show();
this.element.find(".oj-menu-item").removeClass("oj-menu-item").removeAttr("role").children("a").removeAttr("aria-disabled").removeUniqueId().removeClass("oj-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var a=e(this);a.data("oj-ojMenu-submenu-icon")&&a.remove()});this.element.find("a").removeAttr("aria-expanded");this.element.find(".oj-menu-divider").removeClass("oj-menu-divider").removeAttr("role");this.VN();0<=a.indexOf(this)&&a.splice(a.indexOf(this),
1)},bi:function(a){function b(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$\x26")}var f,h,g,k,l=!0;switch(a.keyCode){case e.ui.keyCode.HOME:this.Po("first","first",a);break;case e.ui.keyCode.END:this.Po("last","last",a);break;case e.ui.keyCode.UP:this.previous(a);break;case e.ui.keyCode.DOWN:this.next(a);break;case e.ui.keyCode.LEFT:case e.ui.keyCode.RIGHT:a.keyCode===e.ui.keyCode.RIGHT^this.rm?this.aa&&!this.aa.is(".oj-disabled")&&this.expand(a):this.collapse(a);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this.zg(a);
this.wn=!0;var m=this;setTimeout(function(){m.wn=!1},100);break;case e.ui.keyCode.ESCAPE:this.bb?(h=this.element.attr("aria-activedescendant"),g="#"+this.element.attr("id")+"\x3e*\x3ea",h&&!e("#"+h).is(g)?this.collapse(a):this.zr(a)):this.collapse(a);break;default:l=!1,f=this.Jp||"",h=String.fromCharCode(a.keyCode),g=!1,clearTimeout(this.UO),h===f?g=!0:h=f+h,k=RegExp("^"+b(h),"i"),f=this.Ol.children(".oj-menu-item").filter(function(){return k.test(e(this).children("a").text())}),f=g&&-1!==f.index(this.aa.next())?
this.aa.nextAll(".oj-menu-item"):f,f.length||(h=String.fromCharCode(a.keyCode),k=RegExp("^"+b(h),"i"),f=this.Ol.children(".oj-menu-item").filter(function(){return k.test(e(this).children("a").text())})),f.length?(this.focus(a,f),1<f.length?(this.Jp=h,this.UO=this._delay(function(){delete this.Jp},1E3)):delete this.Jp):delete this.Jp}l&&a.preventDefault()},zg:function(a){this.aa.is(".oj-disabled")||(this.aa.children("a[aria-haspopup\x3d'true']").length?this.expand(a):this.select(a))},refresh:function(){this._super();
this.kb()},kb:function(){this.rm="rtl"===this.xc();var a=this,b=this.element.find(this.options.menuSelector);b.filter(":not(.oj-menu)").addClass("oj-menu oj-component").hide().attr({role:this.role,"aria-hidden":"true"}).each(function(){var b=e(this),c=a.Xr(b),g=e("\x3cspan\x3e");g.addClass("oj-menu-submenu-icon oj-component-icon").data("oj-ojMenu-submenu-icon",!0);c.attr("aria-haspopup","true").attr("aria-expanded","false").prepend(g);c=c.attr("id");b.attr("aria-labelledby",c)});b=b.add(this.element).children();
b.filter(".oj-menu-divider").has("a").removeClass("oj-menu-divider oj-menu-item").removeAttr("role");b.filter(":not(.oj-menu-item):has(a)").addClass("oj-menu-item").attr("role","presentation").children("a").uniqueId().attr({tabIndex:"-1",role:"menuitem"});b.filter(":not(.oj-menu-item)").each(function(){var a=e(this);/[^\-\u2014\u2013\s]/.test(a.text())||a.addClass("oj-menu-divider").attr("role","separator")});b.filter(".oj-disabled").children("a").attr("aria-disabled","true");b.filter(":not(.oj-disabled)").children("a").removeAttr("aria-disabled");
this.aa&&!e.contains(this.element[0],this.aa[0])&&this.blur()},Xr:function(a){return a.prev("a")},KR:o_d("menuitem"),focus:function(a,b){var f;this.blur(a,a&&"focus"===a.type);this.aa=b.first();f=this.aa.children("a").addClass("oj-focus");this.role&&this.element.attr("aria-activedescendant",f.attr("id"));this.aa.parent().closest(".oj-menu-item").children("a:first").addClass("oj-active");a&&"keydown"===a.type?this.Ik():this.ef=this._delay(function(){this.Ik()},this.delay);f=b.children(".oj-menu");
f.length&&(a&&/^mouse/.test(a.type)&&!this.aa.hasClass("oj-disabled"))&&this.EN(f);this.Ol=b.parent();this._trigger("focus",a,{item:b})},blur:function(a,b){b||clearTimeout(this.ef);this.aa&&(this.aa.children("a").removeClass("oj-focus"),this.aa=null,this._trigger("blur",a,{item:this.aa}))},zr:function(a){this.bb.focus();this.vn(a)},vn:function(b){this.element.hide().attr("aria-hidden","true");this.bb=void 0;this._trigger("__dismiss",b,{});0<=a.indexOf(this)&&a.splice(a.indexOf(this),1)},show:function(b,
c){this.$L||(this.ZL(),this.$L=!0);if(c&&c.launcher){var f=c.launcher;if(this._trigger("beforeShow",b,{launcher:f})){var f="string"===e.type(f)?e("#"+f):f,h=this.element[0],g=a.slice(0,a.length);e.each(g,function(a,c){c.element[0]!==h&&(c.collapseAll(b),c.bb&&c.vn(b))});g=e.extend({},this.options.menuPosition);null==g.of&&(g.of=b&&"contextmenu"===b.type?b:f);this.element.show().removeAttr("aria-hidden").position(g);((g="firstItem"===c.focus)||"menu"===c.focus)&&this.element.focus();g?this.focus(b,
this.element.children().first()):this.blur(b);this.bb=f;a.push(this)}}},ZL:function(){this.element.css({position:"absolute",zIndex:999})},EN:function(a){clearTimeout(this.ef);"true"===a.attr("aria-hidden")&&(this.ef=this._delay(function(){this.Ik();this.eA(a)},this.delay))},eA:function(b){var c=e.extend({of:this.aa},this.options.submenuPosition);clearTimeout(this.ef);this.element.find(".oj-menu").not(b.parents(".oj-menu")).hide().attr("aria-hidden","true");b.show().removeAttr("aria-hidden").position(c);
this.Xr(b).attr("aria-expanded","true");!this.bb&&0>a.indexOf(this)&&a.push(this)},collapseAll:function(a,b){this.zx(a,b,this.delay)},zx:function(a,b,f){function h(){var f=b?g.element:e(a&&a.target).closest(g.element.find(".oj-menu"));f.length||(f=g.element);g.Ik(f);g.blur(a);g.Ol=f}clearTimeout(this.ef);var g=this;f?this.ef=this._delay(h,f):h()},Ik:function(b){b||(b=this.aa?this.aa.parent():this.element);var c=b.find(".oj-menu");c.hide().attr("aria-hidden","true");this.Xr(c).attr("aria-expanded",
"false");b.find("a.oj-active").removeClass("oj-active");this.bb||0<=a.indexOf(this)&&b===this.element&&a.splice(a.indexOf(this),1)},collapse:function(a){var b=this.aa&&this.aa.parent().closest(".oj-menu-item",this.element);b&&b.length&&(this.Ik(),this.focus(a,b))},expand:function(a){var b=this.aa&&this.aa.children(".oj-menu ").children(".oj-menu-item").first();b&&b.length&&(this.eA(b.parent()),this._delay(function(){this.focus(a,b)}))},next:function(a){this.Po("next","first",a)},previous:function(a){this.Po("prev",
"last",a)},ER:function(){return this.aa&&!this.aa.prevAll(".oj-menu-item").length},GR:function(){return this.aa&&!this.aa.nextAll(".oj-menu-item").length},Po:function(a,b,f){var e;this.aa&&(e="first"===a||"last"===a?this.aa["first"===a?"prevAll":"nextAll"](".oj-menu-item").eq(-1):this.aa[a+"All"](".oj-menu-item").eq(0));e&&e.length&&this.aa||(e=this.Ol.children(".oj-menu-item")[b]());this.focus(f,e)},select:function(a){if(!this.aa&&a&&a.target){var b=e(a.target).closest(".oj-menu-item");b.closest(this.element).length&&
(this.aa=b)}this.aa&&(b={item:this.aa},this.aa.has(".oj-menu").length||this.zx(a,!0),this.bb&&(b.item.children(this.options.menuSelector).length||this.zr(a)),this._trigger("select",a,b))}});var a=[]})()});
//# sourceMappingURL=oj-modular.map