define(["ojs/ojcore","jquery","ojs/ojdatacollection-common","ojs/ojmodel"],function(b){b.Kb=function(e,a,d,c,f,h,g){b.f.Gb(e,null);b.f.Gb(a,null);b.f.Gb(d,null);b.f.Gb(c,null);b.f.cm(h);this.bf=e;this.Di=a;this.Fe=d;this.lg=c;this.th=f;this.rc=h;this.Ei=g};o_("CollectionCellSet",b.Kb,b);b.Kb.prototype.getData=function(e){var a=this;this.sa(e);this.sa(e).done(function(b){a.gd=b});if(null==a.gd)return null;e=e.column;b.f.assert(e>=this.Fe&&e<=this.lg);return a.gd.get(this.rc[e])};b.a.c("CollectionCellSet.prototype.getData",
{getData:b.Kb.prototype.getData});b.Kb.prototype.getMetadata=function(e){var a=this;this.sa(e);this.sa(e).done(function(b){a.gd=b});if(null==a.gd)return null;e=e.column;b.f.assert(e>=this.Fe&&e<=this.lg);return{keys:{row:b.Ch.pj(a.gd),column:this.rc[e]}}};b.a.c("CollectionCellSet.prototype.getMetadata",{getMetadata:b.Kb.prototype.getMetadata});b.Kb.prototype.sa=function(e){var a;b.f.sd(e);a=e.row;null!=this.Ei&&(a+=this.Ei);e=e.column;b.f.assert(a>=this.bf&&a<=this.Di&&e>=this.Fe&&e<=this.lg);return this.th.at(a,
{deferred:!0})};b.Kb.prototype.W=function(b){return"row"===b?Math.max(0,this.Di-this.bf):"column"===b?Math.max(0,this.lg-this.Fe):0};b.a.c("CollectionCellSet.prototype.getCount",{W:b.Kb.prototype.W});b.Kb.prototype.lm=o_c("bf");b.a.c("CollectionCellSet.prototype.getStartRow",{lm:b.Kb.prototype.lm});b.Kb.prototype.iD=o_c("Di");b.a.c("CollectionCellSet.prototype.getEndRow",{iD:b.Kb.prototype.iD});b.Kb.prototype.km=o_c("Fe");b.a.c("CollectionCellSet.prototype.getStartColumn",{km:b.Kb.prototype.km});
b.Kb.prototype.hD=o_c("lg");b.a.c("CollectionCellSet.prototype.getEndColumn",{hD:b.Kb.prototype.hD});b.Kb.prototype.getCollection=o_c("th");b.a.c("CollectionCellSet.prototype.getCollection",{getCollection:b.Kb.prototype.getCollection});b.Kb.prototype.lh=o_c("rc");b.a.c("CollectionCellSet.prototype.getColumns",{lh:b.Kb.prototype.lh});b.Ch=o_a();b.Ch.pj=function(b){var a;a=b.je();null==a&&(a=b.Oi());return a};b.ac=function(e,a,d,c,f,h){b.f.Gb(e,null);b.f.Gb(a,null);b.f.cm(d);this.sc=e;this.af=a;this.Jp=
d;this.th=c;this.Ee=f;this.Ei=h};o_("CollectionHeaderSet",b.ac,b);b.ac.prototype.getData=function(e){b.f.assert(e<=this.af&&e>=this.sc);var a=this;return null!=this.Ee&&null!=this.th?(null!=this.Ei&&(e+=this.Ei),this.th.at(e,{deferred:!0}).done(function(b){a.gd=b}),a.gd.get(this.Ee)):this.Jp[e]};b.a.c("CollectionHeaderSet.prototype.getData",{getData:b.ac.prototype.getData});b.ac.prototype.getMetadata=function(e){var a;return null!=this.Ee&&null!=this.th?(a=this,null!=this.Ei&&(e+=this.Ei),this.th.at(e,
{deferred:!0}).done(function(b){a.gd=b}),null==a.gd?null:{key:b.Ch.pj(a.gd)}):{key:this.getData(e)}};b.a.c("CollectionHeaderSet.prototype.getMetadata",{getMetadata:b.ac.prototype.getMetadata});b.ac.prototype.W=function(){return Math.max(0,this.af-this.sc)};b.a.c("CollectionHeaderSet.prototype.getCount",{W:b.ac.prototype.W});b.ac.prototype.Ba=o_c("sc");b.a.c("CollectionHeaderSet.prototype.getStart",{Ba:b.ac.prototype.Ba});b.ac.prototype.gD=o_c("af");b.a.c("CollectionHeaderSet.prototype.getEnd",{gD:b.ac.prototype.gD});
b.ac.prototype.nD=o_c("Jp");b.a.c("CollectionHeaderSet.prototype.getHeaders",{nD:b.ac.prototype.nD});b.ac.prototype.im=o_c("Ee");b.a.c("CollectionHeaderSet.prototype.getRowHeader",{im:b.ac.prototype.im});b.ac.prototype.getCollection=o_c("th");b.a.c("CollectionHeaderSet.prototype.getCollection",{getCollection:b.ac.prototype.getCollection});b.X=function(e,a){this.ba=e;null!=a&&(this.ug=a.rowHeader,this.columns=a.columns);this.S=0;this.Ue=this.Nb=-1;b.X.j.constructor.call(this)};o_("CollectionDataGridDataSource",
b.X,b);b.a.ga(b.X,b.Lb,"oj.CollectionDataGridDataSource");b.X.prototype.Init=function(){b.X.j.Init.call(this);this.Qp={};!this.Bs()&&(null==this.columns&&0<this.ba.length)&&(this.columns=this.ba.first().keys(),-1!=this.columns.indexOf(this.ug)&&this.columns.splice(this.columns.indexOf(this.ug),1));this.UM()};b.a.c("CollectionDataGridDataSource.prototype.Init",{Init:b.X.prototype.Init});b.X.prototype.UM=function(){this.ba.on("add",this.LK.bind(this));this.ba.on("remove",this.NK.bind(this));this.ba.on("change",
this.MK.bind(this));this.ba.on("refresh",this.mK.bind(this))};b.X.prototype.Bs=function(){return null!=this.ba.url};b.X.prototype.uL=function(){return this.Bs()?null!=this.data:!0};b.X.prototype.Nz=function(b){if(this.Bs()){if("column"===b)return null!=this.columns;if("row"===b&&null!=this.ug)return null!=this.data}return!0};b.X.prototype.W=function(b){if(!this.Nz(b))return this.precision="estimate",-1;this.precision="exact";return"row"==b?this.size():"column"==b?this.columns.length:0};b.a.c("CollectionDataGridDataSource.prototype.getCount",
{W:b.X.prototype.W});b.X.prototype.ze=function(b){null==this.precision&&this.W(b);return this.precision};b.a.c("CollectionDataGridDataSource.prototype.getCountPrecision",{ze:b.X.prototype.ze});b.X.prototype.wd=function(b,a,d){var c,f;c=b.axis;this.Nz(c)?this.sz(b,a,d):null!=a&&(f={},f.LP=b,f.callbacks=a,f.Ht=d,this.Qp[c]=f)};b.a.c("CollectionDataGridDataSource.prototype.fetchHeaders",{wd:b.X.prototype.wd});b.X.prototype.sz=function(e,a,d){var c,f,h,g;c=e.axis;f=e.start;h=e.count;b.f.assert("row"===
c||"column"===c);b.f.assert(0<h);"column"===c?null!=this.columns?(h=Math.min(this.columns.length,f+h),g=new b.ac(f,h,this.columns)):g=new b.Od(f,f,c,null):"row"===c&&(null!=this.ug?(h=Math.min(this.size(),f+h),0<this.Nb?(h=Math.min(h,this.S+this.Nb),h=Math.min(h,this.totalSize()-this.S),g=new b.ac(f,h,this.columns,this.ba,this.ug,this.S)):g=new b.ac(f,h,this.columns,this.ba,this.ug)):g=new b.Od(f,f,c,null));null!=a&&a.success&&a.success.call(d.success,g,e);this.Qp[c]=null};b.X.prototype.bz=function(e){var a,
d,c,f,h,g;for(a=0;a<e.length;a+=1)d=e[a],b.f.assert("row"===d.axis||"column"===d.axis),b.f.assert(0<d.count),"row"===d.axis?(c=d.start,f=d.count):"column"===d.axis&&(h=d.start,g=d.count);return{rowStart:c,rowCount:f,colStart:h,colCount:g}};b.X.prototype.rz=function(e,a,d){var c,f,h,g;c=this.bz(e);f=c.rowStart;h=Math.min(this.size(),f+c.rowCount);g=c.colStart;c=Math.min(this.columns.length,g+c.colCount);0<this.Nb?(h=Math.min(this.Nb,this.totalSize()-this.S),f=new b.Kb(f,h,g,c,this.ba,this.columns,
this.S)):f=new b.Kb(f,h,g,c,this.ba,this.columns);null!=a&&null!=a.success&&(null!=a&&null==d&&(d={}),a.success.call(d.success,f,e),this.VI=0);this.wh=null};b.X.prototype.ud=function(b,a,d){this.uL()?this.rz(b,a,d):(null!=a&&(this.wh={},this.wh.QO=b,this.wh.callbacks=a,this.wh.Ht=d),this.WI(b))};b.a.c("CollectionDataGridDataSource.prototype.fetchCells",{ud:b.X.prototype.ud});b.X.prototype.AA=function(b){var a,d;a=this.Qp[b];null!=a&&(b=a.LP,d=a.callbacks,a=a.Ht,this.sz(b,d,a))};b.X.prototype.AM=function(){this.rz(this.wh.QO,
this.wh.callbacks,this.wh.Ht)};b.X.prototype.WI=function(e){var a;e=this.bz(e);a=e.rowStart;0<this.Nb&&(a+=this.S);this.ba.Wp(a,e.rowCount).done(function(){var d=this.ba.at(a,{deferred:!0});null!=d&&void 0===this.columns&&d.done(function(a){this.columns=a.keys();-1!=this.columns.indexOf(this.ug)&&this.columns.splice(this.columns.indexOf(this.ug),1)}.bind(this));null!=this.Qp&&(this.AA("column"),this.AA("row"));null!=this.wh&&this.AM();0<this.Nb&&b.Lb.j.handleEvent.call(this,"sync",!0)}.bind(this))};
b.X.prototype.keys=function(e){var a=e.row+this.S;return{row:void 0===this.ba.models[a]?void 0:b.Ch.pj(this.ba.models[a]),column:this.columns[e.column]}};b.a.c("CollectionDataGridDataSource.prototype.keys",{keys:b.X.prototype.keys});b.X.prototype.yd=function(b){var a=b.column;return{row:this.ba.models.indexOf(this.ba.get(b.row)),column:void 0===this.columns?this.ba.first().keys().indexOf(a):this.columns.indexOf(a)}};b.a.c("CollectionDataGridDataSource.prototype.indexes",{yd:b.X.prototype.yd});b.X.prototype.getCapability=
function(b){return"sort"===b?"column":"move"===b?"row":null};b.a.c("CollectionDataGridDataSource.prototype.getCapability",{getCapability:b.X.prototype.getCapability});b.X.prototype.sort=function(b,a,d){var c,f=b.direction,h=b.key;b=b.axis;null==d&&(d={});"column"===b?(-1<this.ba.Vt&&this.ba.hasMore?(this.ba.comparator=h,this.ba.sortDirection="ascending"===f?1:-1):("ascending"===f&&(c=function(a,b){var c,d;a=a.get(h);b=b.get(h);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString(),c=!0);b instanceof
Date&&(b=b.toISOString(),d=!0);return c&&d?a<b?-1:a===b?0:1:c?1:d?-1:a-b}),"descending"===f&&(c=function(a,b){var c,d;a=a.get(h);b=b.get(h);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString());b instanceof Date&&(b=b.toISOString());return c&&d?a>b?-1:a===b?0:1:c?-1:d?1:b-a}),this.ba.comparator=c),this.ba.sort(),null!=a&&null!=a.success&&a.success.call(d.success)):null!=a&&null!=a.error&&a.error.call(d.error,"Axis value not supported")};b.a.c("CollectionDataGridDataSource.prototype.sort",{sort:b.X.prototype.sort});
b.X.prototype.move=function(b,a){var d,c;d=this.ba.get(b);null===a?(this.ba.remove(d),this.ba.add(d)):(b===a?(c=this.ba.indexOf(this.ba.get(a)),this.ba.remove(d)):(this.ba.remove(d),c=this.ba.indexOf(this.ba.get(a))),this.ba.add(d,{at:c}))};b.a.c("CollectionDataGridDataSource.prototype.move",{move:b.X.prototype.move});b.X.prototype.vo=function(b,a){var d={source:this};d.operation=b;d.keys={row:a,column:null};return d};b.X.prototype.LK=function(e){this.handleEvent("change",this.vo("insert",b.Ch.pj(e)))};
b.X.prototype.NK=function(e){this.handleEvent("change",this.vo("delete",b.Ch.pj(e)))};b.X.prototype.MK=function(e){this.handleEvent("change",this.vo("update",b.Ch.pj(e)))};b.X.prototype.mK=function(){this.handleEvent("change",this.vo("refresh",null))};b.X.prototype.setPageSize=o_b("Nb");b.a.c("CollectionDataGridDataSource.prototype.setPageSize",{setPageSize:b.X.prototype.setPageSize});b.X.prototype.size=function(){return 0===this.ba.length?-1:null!=this.Nb&&0<this.Nb&&this.ba.size()>this.Nb?this.Nb:
this.ba.size()};b.a.c("CollectionDataGridDataSource.prototype.size",{size:b.X.prototype.size});b.X.prototype.totalSize=function(){return null!=this.ba&&0>this.Ue?this.ba.length:this.Ue};b.a.c("CollectionDataGridDataSource.prototype.totalSize",{totalSize:b.X.prototype.totalSize});b.X.prototype.hasMore=function(){return null!=this.ba?this.ba.hasMore:!1};b.a.c("CollectionDataGridDataSource.prototype.hasMore",{hasMore:b.X.prototype.hasMore});b.X.prototype.fetch=function(b){this.S=null!=b?null!=b.startIndex?
b.startIndex:0:0;this.handleEvent("change",{operation:"sync",pageSize:this.Nb})};b.X.prototype.getCollection=o_c("ba");b.a.c("CollectionDataGridDataSource.prototype.getCollection",{getCollection:b.X.prototype.getCollection});b.X.prototype.lh=o_c("columns");b.a.c("CollectionDataGridDataSource.prototype.getColumns",{lh:b.X.prototype.lh});b.X.prototype.im=o_c("ug");b.a.c("CollectionDataGridDataSource.prototype.getRowHeader",{im:b.X.prototype.im});b.X.prototype.vD=o_c("S");b.a.c("CollectionDataGridDataSource.prototype.getStartIndex",
{vD:b.X.prototype.vD});b.X.prototype.oD=o_c("Nb");b.a.c("CollectionDataGridDataSource.prototype.getPageSize",{oD:b.X.prototype.oD});b.X.prototype.CD=o_c("Ue");b.a.c("CollectionDataGridDataSource.prototype.getTotalSize",{CD:b.X.prototype.CD});b.X.prototype.kD=o_c("VI");b.a.c("CollectionDataGridDataSource.prototype.getFetchCalls",{kD:b.X.prototype.kD});b.X.prototype.getData=o_c("data");b.a.c("CollectionDataGridDataSource.prototype.getData",{getData:b.X.prototype.getData})});
//# sourceMappingURL=oj-modular.map