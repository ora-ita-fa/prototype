define(["ojs/ojcore","jquery","ojs/ojdatacollection-common","ojs/ojmodel"],function(a){a.Jb=function(e,d,b,c,f,h){a.f.Ab(e,null);a.f.Ab(d,null);a.f.Ab(b,null);a.f.Ab(c,null);a.f.$k(h);this.Qe=e;this.Qh=d;this.me=b;this.Mf=c;this.Ig=f;this.gc=h};o_("CollectionCellSet",a.Jb,a);a.Jb.prototype.getData=function(e){var d=this;this.ja(e);this.ja(e).done(function(a){d.Vc=a});if(null==d.Vc)return null;e=e.column;a.f.assert(e>=this.me&&e<=this.Mf);return d.Vc.get(this.gc[e])};a.a.b("CollectionCellSet.prototype.getData",
{getData:a.Jb.prototype.getData});a.Jb.prototype.getMetadata=function(e){var d=this;this.ja(e);this.ja(e).done(function(a){d.Vc=a});if(null==d.Vc)return null;e=e.column;a.f.assert(e>=this.me&&e<=this.Mf);return{keys:{row:d.Vc.Ye(),column:this.gc[e]}}};a.a.b("CollectionCellSet.prototype.getMetadata",{getMetadata:a.Jb.prototype.getMetadata});a.Jb.prototype.ja=function(e){var d;a.f.sd(e);d=e.row;e=e.column;a.f.assert(d>=this.Qe&&d<=this.Qh&&e>=this.me&&e<=this.Mf);return this.Ig.at(d,{deferred:!0})};
a.Jb.prototype.R=function(a){return"row"===a?Math.max(0,this.Qh-this.Qe):"column"===a?Math.max(0,this.Mf-this.me):0};a.a.b("CollectionCellSet.prototype.getCount",{R:a.Jb.prototype.R});a.Jb.prototype.kl=o_c("Qe");a.a.b("CollectionCellSet.prototype.getStartRow",{kl:a.Jb.prototype.kl});a.Jb.prototype.rB=o_c("Qh");a.a.b("CollectionCellSet.prototype.getEndRow",{rB:a.Jb.prototype.rB});a.Jb.prototype.jl=o_c("me");a.a.b("CollectionCellSet.prototype.getStartColumn",{jl:a.Jb.prototype.jl});a.Jb.prototype.qB=
o_c("Mf");a.a.b("CollectionCellSet.prototype.getEndColumn",{qB:a.Jb.prototype.qB});a.Jb.prototype.Ne=o_c("Ig");a.a.b("CollectionCellSet.prototype.getCollection",{Ne:a.Jb.prototype.Ne});a.Jb.prototype.Eg=o_c("gc");a.a.b("CollectionCellSet.prototype.getColumns",{Eg:a.Jb.prototype.Eg});a.$b=function(e,d,b,c,f){a.f.Ab(e,null);a.f.Ab(d,null);a.f.$k(b);this.hc=e;this.Pe=d;this.Bo=b;this.Ig=c;this.le=f};o_("CollectionHeaderSet",a.$b,a);a.$b.prototype.getData=function(e){a.f.assert(e<=this.Pe&&e>=this.hc);
var d=this;return null!=this.le&&null!=this.Ig?(this.Ig.at(e,{deferred:!0}).done(function(a){d.Vc=a}),d.Vc.get(this.le)):this.Bo[e]};a.a.b("CollectionHeaderSet.prototype.getData",{getData:a.$b.prototype.getData});a.$b.prototype.getMetadata=function(a){var d;return null!=this.le&&null!=this.Ig?(d=this,this.Ig.at(a,{deferred:!0}).done(function(a){d.Vc=a}),null==d.Vc?null:{key:d.Vc.Ye()}):{key:this.getData(a)}};a.a.b("CollectionHeaderSet.prototype.getMetadata",{getMetadata:a.$b.prototype.getMetadata});
a.$b.prototype.R=function(){return Math.max(0,this.Pe-this.hc)};a.a.b("CollectionHeaderSet.prototype.getCount",{R:a.$b.prototype.R});a.$b.prototype.pa=o_c("hc");a.a.b("CollectionHeaderSet.prototype.getStart",{pa:a.$b.prototype.pa});a.$b.prototype.pB=o_c("Pe");a.a.b("CollectionHeaderSet.prototype.getEnd",{pB:a.$b.prototype.pB});a.$b.prototype.wB=o_c("Bo");a.a.b("CollectionHeaderSet.prototype.getHeaders",{wB:a.$b.prototype.wB});a.$b.prototype.hl=o_c("le");a.a.b("CollectionHeaderSet.prototype.getRowHeader",
{hl:a.$b.prototype.hl});a.$b.prototype.Ne=o_c("Ig");a.a.b("CollectionHeaderSet.prototype.getCollection",{Ne:a.$b.prototype.Ne});a.S=function(e,d){this.Z=e;null!=d&&(this.Xf=d.rowHeader,this.columns=d.columns);this.K=0;this.de=this.dc=-1;this.Il=this.nl=!1;a.S.j.constructor.call(this)};o_("CollectionDataGridDataSource",a.S,a);a.a.aa(a.S,a.Eb,"oj.CollectionDataGridDataSource");a.S.prototype.h=function(){a.S.j.h.call(this);this.ne={};this.jy()?this.nl=!0:null==this.columns&&0<this.Z.length&&(this.columns=
this.Z.first().keys(),-1!=this.columns.indexOf(this.Xf)&&this.columns.splice(this.columns.indexOf(this.Xf),1));this.CK()};a.a.b("CollectionDataGridDataSource.prototype.Init",{h:a.S.prototype.h});a.S.prototype.CK=function(){this.Z.on("add",this.rI.bind(this));this.Z.on("remove",this.tI.bind(this));this.Z.on("change",this.sI.bind(this));this.Z.on("sync",this.AI.bind(this))};a.S.prototype.jy=function(){return null!=this.Z.url};a.S.prototype.dr=function(){return this.jy()?null!=this.data:!0};a.S.prototype.WH=
function(e,d,b){var c;this.data=b;!0===e?this.nl=!1:this.Il=!1;this.de=void 0===d.Kl?d.length:d.Kl;a.Eb.j.handleEvent.call(this,"sync",!0);null==this.columns&&0<this.Z.models.length&&(this.columns=this.Z.models[0].keys(),-1!=this.columns.indexOf(this.Xf)&&this.columns.splice(this.columns.indexOf(this.Xf),1));for(c in this.ne)this.ne.hasOwnProperty(c)&&null!=this.ne[c]&&this.Rc(this.ne[c].HB,this.ne[c].callbacks,this.ne[c].al);null!=this.vd&&this.Qc(this.vd.YA,this.vd.callbacks,this.vd.al)};a.S.prototype.R=
function(a){if(!this.dr())return this.precision="estimate",-1;this.precision="exact";return"row"==a?this.size():"column"==a?this.columns.length:0};a.a.b("CollectionDataGridDataSource.prototype.getCount",{R:a.S.prototype.R});a.S.prototype.he=function(a){null==this.precision&&this.R(a);return this.precision};a.a.b("CollectionDataGridDataSource.prototype.getCountPrecision",{he:a.S.prototype.he});a.S.prototype.Rc=function(a,d,b){var c,f;c=a.axis;this.dr()?this.Kx(a,d,b):null!=d&&null==this.ne[c]&&(f=
{},f.HB=a,f.callbacks=d,f.al=b,this.ne[c]=f)};a.a.b("CollectionDataGridDataSource.prototype.fetchHeaders",{Rc:a.S.prototype.Rc});a.S.prototype.Kx=function(e,d,b){var c,f,h,g;c=e.axis;f=e.start;h=e.count;a.f.assert("row"===c||"column"===c);a.f.assert(0<h);"column"===c?null!=this.columns?(h=Math.min(this.columns.length,f+h),g=new a.$b(f,h,this.columns)):g=new a.xd(f,f,c,null):"row"===c&&(null!=this.Xf?(h=Math.min(this.size(),f+h),0<this.dc&&(h=Math.min(h,this.K+this.dc),h=Math.min(h,this.totalSize()-
this.K)),g=new a.$b(f,h,this.columns,this.Z,this.Xf)):g=new a.xd(f,f,c,null));null!=d&&d.success&&d.success.call(b.success,g,e);this.ne[c]=null};a.S.prototype.nx=function(e){var d,b,c,f,h,g;for(d=0;d<e.length;d+=1)b=e[d],a.f.assert("row"===b.axis||"column"===b.axis),a.f.assert(0<b.count),"row"===b.axis?(c=b.start,f=b.count):"column"===b.axis&&(h=b.start,g=b.count);return{rowStart:c,rowCount:f,colStart:h,colCount:g}};a.S.prototype.Jx=function(e,d,b){var c,f,h,g;c=this.nx(e);f=c.rowStart;h=Math.min(this.size(),
f+c.rowCount);g=c.colStart;c=Math.min(this.columns.length,g+c.colCount);f=new a.Jb(f,h,g,c,this.Z,this.columns);null!=d&&null!=d.success&&(null!=d&&null==b&&(b={}),d.success.call(b.success,f,e),this.IG=0);this.vd=null};a.S.prototype.Qc=function(a,d,b){this.dr()?this.Jx(a,d,b):(null!=d&&null==this.vd&&(this.vd={},this.vd.YA=a,this.vd.callbacks=d,this.vd.al=b),this.JG(a))};a.a.b("CollectionDataGridDataSource.prototype.fetchCells",{Qc:a.S.prototype.Qc});a.S.prototype.Qy=function(a){var d,b;d=this.ne[a];
null!=d&&(a=d.HB,b=d.callbacks,d=d.al,this.Kx(a,b,d))};a.S.prototype.hK=function(){this.Jx(this.vd.YA,this.vd.callbacks,this.vd.al)};a.S.prototype.JG=function(a){var d;a=this.nx(a);d=a.rowStart;this.Z.Ko(d,a.rowCount).done(function(){var a=this.Z.at(d,{deferred:!0});null!=a&&void 0===this.columns&&a.done(function(a){this.columns=a.keys();-1!=this.columns.indexOf(this.Xf)&&this.columns.splice(this.columns.indexOf(this.Xf),1)}.bind(this));null!=this.ne&&(this.Qy("column"),this.Qy("row"));null!=this.vd&&
this.hK()}.bind(this))};a.S.prototype.keys=function(a){var d=a.row;return{row:void 0===this.Z.models[d]?void 0:this.Z.models[d].cid,column:this.columns[a.column]}};a.a.b("CollectionDataGridDataSource.prototype.keys",{keys:a.S.prototype.keys});a.S.prototype.ed=function(a){var d=a.column;return{row:this.Z.models.indexOf(this.Z.Lh(a.row)),column:void 0===this.columns?this.Z.first().keys().indexOf(d):this.columns.indexOf(d)}};a.a.b("CollectionDataGridDataSource.prototype.indexes",{ed:a.S.prototype.ed});
a.S.prototype.Ua=function(a){return"sort"===a?"column":"move"===a?"row":null};a.a.b("CollectionDataGridDataSource.prototype.getCapability",{Ua:a.S.prototype.Ua});a.S.prototype.sort=function(a,d,b){var c,f=a.direction,h=a.key;a=a.axis;null==b&&(b={});"column"===a?("ascending"===f&&(c=function(a,b){var c,d;a=a.get(h);b=b.get(h);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString(),c=!0);b instanceof Date&&(b=b.toISOString(),d=!0);return c&&d?a<b?-1:a===b?0:1:c?1:d?-1:a-b}),"descending"===f&&(c=
function(a,b){var c,d;a=a.get(h);b=b.get(h);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString());b instanceof Date&&(b=b.toISOString());return c&&d?a>b?-1:a===b?0:1:c?-1:d?1:b-a}),void 0!==c?(this.Z.comparator=c,this.Z.sort(),null!=d&&null!=d.success&&d.success.call(b.success)):null!=d&&null!=d.error&&d.error.call(b.error,"Direction value was invalid")):null!=d&&null!=d.error&&d.error.call(b.error,"Axis value not supported")};a.a.b("CollectionDataGridDataSource.prototype.sort",{sort:a.S.prototype.sort});
a.S.prototype.move=function(a,d){var b,c;b=this.Z.Lh(a);null===d?(this.Z.remove(b),this.Z.add(b)):(a===d?(c=this.Z.indexOf(this.Z.Lh(d)),this.Z.remove(b)):(this.Z.remove(b),c=this.Z.indexOf(this.Z.Lh(d))),this.Z.add(b,{at:c}))};a.a.b("CollectionDataGridDataSource.prototype.move",{move:a.S.prototype.move});a.S.prototype.Gq=function(a,d){var b={source:this};b.operation=a;b.keys={row:d,column:null};return b};a.S.prototype.rI=function(a){!1===this.Il&&!1===this.nl&&(a=a.Ye(),a=this.Gq("insert",a),this.handleEvent("change",
a))};a.S.prototype.tI=function(a){!1===this.Il&&!1===this.nl&&(a=a.Ye(),a=this.Gq("delete",a),this.handleEvent("change",a))};a.S.prototype.sI=function(a){!1===this.Il&&!1===this.nl&&(a=a.Ye(),a=this.Gq("update",a),this.handleEvent("change",a))};a.S.prototype.AI=function(){0<this.dc&&(this.ne={},this.vd=null,this.handleEvent("change",{operation:"sync",pageSize:this.dc,rowIndex:this.K}))};a.S.prototype.Re=o_b("dc");a.a.b("CollectionDataGridDataSource.prototype.setPageSize",{Re:a.S.prototype.Re});a.S.prototype.size=
function(){return 0===this.Z.length?-1:null!=this.dc&&0<this.dc&&this.Z.size()>this.dc?this.dc:this.Z.size()};a.a.b("CollectionDataGridDataSource.prototype.size",{size:a.S.prototype.size});a.S.prototype.totalSize=function(){return null!=this.Z&&0>this.de?this.Z.totalResults:this.de};a.a.b("CollectionDataGridDataSource.prototype.totalSize",{totalSize:a.S.prototype.totalSize});a.S.prototype.hasMore=function(){return null!=this.Z?this.Z.hasMore:!1};a.a.b("CollectionDataGridDataSource.prototype.hasMore",
{hasMore:a.S.prototype.hasMore});a.S.prototype.fetch=function(a){this.Il=!0;this.K=null!=a?null!=a.startIndex?a.startIndex:0:0;this.Z.fetch({success:this.WH.bind(this,!1),startIndex:this.K})};a.a.b("CollectionDataGridDataSource.prototype.fetch",{fetch:a.S.prototype.fetch});a.S.prototype.Ne=o_c("Z");a.a.b("CollectionDataGridDataSource.prototype.getCollection",{Ne:a.S.prototype.Ne});a.S.prototype.Eg=o_c("columns");a.a.b("CollectionDataGridDataSource.prototype.getColumns",{Eg:a.S.prototype.Eg});a.S.prototype.hl=
o_c("Xf");a.a.b("CollectionDataGridDataSource.prototype.getRowHeader",{hl:a.S.prototype.hl});a.S.prototype.AB=o_c("K");a.a.b("CollectionDataGridDataSource.prototype.getStartIndex",{AB:a.S.prototype.AB});a.S.prototype.xB=o_c("dc");a.a.b("CollectionDataGridDataSource.prototype.getPageSize",{xB:a.S.prototype.xB});a.S.prototype.BB=o_c("de");a.a.b("CollectionDataGridDataSource.prototype.getTotalSize",{BB:a.S.prototype.BB});a.S.prototype.tB=o_c("IG");a.a.b("CollectionDataGridDataSource.prototype.getFetchCalls",
{tB:a.S.prototype.tB});a.S.prototype.getData=o_c("data");a.a.b("CollectionDataGridDataSource.prototype.getData",{getData:a.S.prototype.getData})});
//# sourceMappingURL=oj-modular.map